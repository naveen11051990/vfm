---
- name: Remediate switch interface down
  hosts: switches            # your inventory group for Cisco switches
  gather_facts: no
  connection: network_cli     # adjust if using e.g. ios, iosxr, nxos
  vars:
    interface_name: "{{ interface_name }}"
    notify_email: "netops-team@example.com"

  tasks:
    - name: Check interface status
      # Using ios_facts for Cisco IOS/IOS-XE; adjust for your platform
      ios_facts:
        gather_subset: interfaces
      register: intf_facts

    - name: Fail if interface not in facts
      fail:
        msg: "Interface {{ interface_name }} not found on host {{ inventory_hostname }}"
      when: interface_name not in intf_facts.ansible_facts.interfaces

    - name: Get current interface operational status
      set_fact:
        current_state: "{{ intf_facts.ansible_facts.interfaces[interface_name].oper_status }}"

    - name: Shut and then no-shutdown the interface if itâ€™s down
      ios_config:
        lines:
          - interface {{ interface_name }}
          - shutdown
          - no shutdown
      when: current_state == 'down'

    - name: Wait for interface to come up
      ios_command:
        commands:
          - show interface {{ interface_name }} | include line protocol
      register: interface_check
      retries: 5
      delay: 10
      until: "'up' in interface_check.stdout[0]"

    - name: Notify about remediation
      mail:
        to: "{{ notify_email }}"
        subject: "Interface {{ interface_name }} remediated on {{ inventory_hostname }}"
        body: |
          Interface {{ interface_name }} was detected down on host {{ inventory_hostname }}.
          Remediation attempted. Post-check output: {{ interface_check.stdout[0] }}
      when: current_state == 'down'
