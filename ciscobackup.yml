---
- name: Full Cisco 9300 Upgrade via TFTP (Mgmt-vrf)
  hosts: 192.168.29.164
  gather_facts: no
  connection: network_cli
  collections:
    - cisco.ios

  tasks:
    - name: Save running-config
      cisco.ios.ios_command:
        commands:
          - write memory
        timeout: 300            # increase timeout for this command
      vars:
        ansible_command_timeout: 300

    - name: Copy running-config to TFTP server
      cisco.ios.ios_command:
        commands:
          - command: "copy system:running-config tftp://192.168.29.23/192.168.29.164_backup"
            prompt:
              - "Address or name of remote host"
              - "Destination filename"
            answer:
              - "192.168.29.23"
              - "192.168.29.164_backup"
        timeout: 600            # increase timeout here too
      vars:
        ansible_command_timeout: 600
      register: copy_result

    - name: Show result of backup
      debug:
        var: copy_result.stdout_lines
