---
- name: Check RBAC Access for Palo Alto Firewall Administrator Accounts
  hosts: "PRODUCTIONFIREWALL"
  connection: local
  gather_facts: false

  vars:
    device:
      ip_address: "{{ ip_address }}"
      username: "{{ username }}"
      password: "{{ password }}"

  collections:
    - paloaltonetworks.panos

  tasks:

    # ---------------------------------------------------
    # Step 0: Initialize variables to prevent undefined errors
    # ---------------------------------------------------
    - name: Initialize RBAC variables
      ansible.builtin.set_fact:
        rbac_enabled_admins: []
        non_rbac_admins: []
        superuser_accounts: []
        superuser_ro_accounts: []
        total_admins: 0
        rbac_enabled_count: 0
        non_rbac_count: 0
        rbac_compliance_percentage: 0

    # ---------------------------------------------------
    # Step 1: Gather administrator accounts
    # ---------------------------------------------------
    - name: Gather administrator accounts information
      paloaltonetworks.panos.panos_administrator:
        provider: "{{ device }}"
        state: gathered
      register: admin_accounts

    - name: Debug gathered administrator accounts
      ansible.builtin.debug:
        var: admin_accounts.gathered

    # ---------------------------------------------------
    # Step 2: Process administrators based on RBAC a
