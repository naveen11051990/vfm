---  
  hosts: PRODUCTIONFIREWALL
  connection: local
  gather_facts: false

  vars:
    device:
      ip_address: "{{ ip_address }}"
      username: "{{ username }}"
      password: "{{ password }}"

  collections:
    - paloaltonetworks.panos

  tasks:
    - name: Get facts (including HA info)
      paloaltonetworks.panos.panos_facts:
        provider: '{{ device }}'
        gather_subset: ['ha']
      register: ha_status

    - name: output data for ha
      debug:
        var: ha_status

    - name: Check compliance â€” HA must be enabled
      ansible.builtin.assert:
        that:
          - ha_status.ansible_net_ha_enabled is defined
          - ha_status.ansible_net_ha_enabled | bool
        success_msg: "COMPLIANT: HA is enabled"
        fail_msg: "NON-COMPLIANT: HA is NOT enabled"

