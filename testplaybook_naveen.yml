---
- name: PAN-OS firewall readiness & compliance report
  hosts: PRODUCTIONFIREWALL
  connection: local
  gather_facts: false

  vars:
    device:
      ip_address: "{{ ip_address }}"
      username: "{{ username }}"
      password: "{{ password }}"
      # port: 443  # optional

  collections:
    - paloaltonetworks.panos

  tasks:
    - name: Run readiness checks (NTP sync, HA, content version)
      panos_readiness_checks:
        provider: "{{ device }}"
        checks:
          - ntp_sync
          - ha
          - content_version
        force_fail: false
      register: readiness
      ignore_errors: yes

    - name: Debug readiness check results
      debug:
        var: readiness.response

    - name: Build compliance status message
      set_fact:
        compliance_status: |
          Host: {{ inventory_hostname }}
            NTP sync        : {{ readiness.response.ntp_sync.state | default(false) | ternary('PASS','FAIL') }} ({{ readiness.response.ntp_sync.reason | default('') }})
            HA / config sync: {{ readiness.response.ha.state | default(false) | ternary('PASS','FAIL') }} ({{ readiness.response.ha.reason | default('') }})
            Content version : {{ readiness.response.content_version.state | default(false) | ternary('PASS','FAIL') }} ({{ readiness.response.content_version.reason | default('') }})

    - name: Show compliance status
      debug:
        msg: "{{ compliance_status }}"
